<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>drift.</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #ff3b30;
            --secondary-color: #ff6b61;
            --dark-color: #121212;
            --dark-secondary: #1e1e1e;
            --light-color: #f5f5f7;
            --text-color: #f5f5f7;
            --border-radius: 12px;
            --transition-speed: 0.3s;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            
            /* School mode variables */
            --school-primary: #ffcc00;
            --school-secondary: #ffd633;
            --school-bg: #ffffff;
            --school-secondary-bg: #f5f5f7;
            --school-text: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--dark-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            transition: background-color var(--transition-speed);
        }

        /* Animation Keyframes */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideInRight {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInLeft {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            animation: fadeIn 0.8s ease-in-out;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            animation: slideUp 0.5s ease-out;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background-color: var(--primary-color);
            border-radius: 10px;
            margin-right: 12px;
            position: relative;
            transition: background-color var(--transition-speed);
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background-color: var(--dark-color);
            border-radius: 5px;
            transition: background-color var(--transition-speed);
        }

        .logo-text {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideUp 0.5s ease-out 0.2s both;
        }

        .toggle-container {
            display: flex;
            align-items: center;
        }

        .toggle-label {
            margin-right: 10px;
            font-size: 14px;
            font-weight: 500;
        }

        .toggle {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--dark-secondary);
            transition: var(--transition-speed);
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: var(--light-color);
            transition: var(--transition-speed);
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .user-menu {
            position: relative;
        }

        .user-btn {
            display: flex;
            align-items: center;
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: color var(--transition-speed);
        }

        .user-btn i {
            margin-right: 8px;
            font-size: 16px;
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 200px;
            background-color: var(--dark-secondary);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 10px;
            margin-top: 10px;
            z-index: 100;
            display: none;
            animation: slideDown 0.3s ease-out;
        }

        .user-dropdown.active {
            display: block;
        }

        .user-dropdown-item {
            padding: 10px;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color var(--transition-speed);
            font-size: 14px;
            display: flex;
            align-items: center;
        }

        .user-dropdown-item i {
            margin-right: 10px;
            width: 16px;
            text-align: center;
        }

        .user-dropdown-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .user-dropdown-divider {
            height: 1px;
            background-color: rgba(255, 255, 255, 0.1);
            margin: 5px 0;
        }

        /* Main Content */
        .main {
            display: flex;
            flex: 1;
            gap: 20px;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--dark-secondary);
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
            transition: background-color var(--transition-speed);
            animation: slideInLeft 0.5s ease-out 0.3s both;
        }

        .sidebar-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: border-color var(--transition-speed);
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: 600;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .chat-list {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .chat-item {
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color var(--transition-speed);
            display: flex;
            align-items: center;
            animation: fadeIn 0.3s ease-in-out;
        }

        .chat-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .chat-item.active {
            background-color: rgba(255, 59, 48, 0.2);
        }

        .chat-item-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            flex-shrink: 0;
            font-size: 14px;
            color: var(--light-color);
            transition: background-color var(--transition-speed);
        }

        .chat-item-content {
            flex: 1;
            overflow: hidden;
        }

        .chat-item-title {
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-item-preview {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-top: 2px;
            transition: color var(--transition-speed);
        }

        .new-chat-btn {
            margin: 10px;
            padding: 10px;
            background-color: var(--primary-color);
            color: var(--light-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color var(--transition-speed), transform 0.2s ease;
        }

        .new-chat-btn:hover {
            transform: translateY(-2px);
        }

        .new-chat-btn i {
            margin-right: 8px;
        }

        .sidebar-footer {
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            transition: border-color var(--transition-speed);
        }

        .sidebar-footer-btn {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            transition: color var(--transition-speed);
        }

        .sidebar-footer-btn i {
            margin-right: 8px;
        }

        /* Chat Section */
        .chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--dark-secondary);
            border-radius: var(--border-radius);
            overflow: hidden;
            transition: background-color var(--transition-speed);
            animation: slideUp 0.5s ease-out 0.3s both;
        }

        .chat-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: border-color var(--transition-speed);
        }

        .chat-title {
            font-size: 16px;
            font-weight: 600;
        }

        .chat-header-actions {
            display: flex;
            gap: 10px;
        }

        .chat-header-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.05);
            border: none;
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color var(--transition-speed);
        }

        .chat-header-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            display: flex;
            animation: fadeIn 0.3s ease-in-out;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message.ai {
            align-self: flex-start;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            margin: 0 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background-color: var(--primary-color);
            color: var(--light-color);
            transition: background-color var(--transition-speed);
        }

        .message.ai .message-avatar {
            background-color: var(--dark-color);
            color: var(--primary-color);
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        .message-content {
            background-color: var(--dark-color);
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.5;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        .message.user .message-content {
            background-color: var(--primary-color);
            border-bottom-right-radius: 4px;
        }

        .message.ai .message-content {
            border-bottom-left-radius: 4px;
        }

        .message-image {
            max-width: 250px;
            max-height: 200px;
            border-radius: 12px;
            margin-top: 10px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .message-image:hover {
            transform: scale(1.05);
        }

        .chat-input-container {
            padding: 15px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: border-color var(--transition-speed);
        }

        .chat-input {
            flex: 1;
            background-color: var(--dark-color);
            border: none;
            border-radius: 24px;
            padding: 12px 20px;
            color: var(--text-color);
            font-size: 14px;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        .chat-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 59, 48, 0.3);
        }

        .chat-send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: var(--light-color);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform 0.2s ease;
        }

        .chat-send-btn:hover {
            transform: scale(1.05);
        }

        .upload-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--dark-color);
            color: var(--text-color);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform 0.2s ease;
        }

        .upload-btn:hover {
            transform: scale(1.05);
        }

        /* Upload Section */
        .upload-section {
            width: 300px;
            background-color: var(--dark-secondary);
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
            transition: background-color var(--transition-speed);
            animation: slideInRight 0.5s ease-out 0.4s both;
        }

        .upload-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: border-color var(--transition-speed);
        }

        .upload-title {
            font-size: 16px;
            font-weight: 600;
        }

        .upload-content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .upload-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 20px;
            transition: color var(--transition-speed);
        }

        .upload-text {
            font-size: 14px;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.7);
            transition: color var(--transition-speed);
        }

        .upload-btn-large {
            background-color: var(--primary-color);
            color: var(--light-color);
            border: none;
            border-radius: 24px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform 0.2s ease;
        }

        .upload-btn-large:hover {
            transform: scale(1.05);
        }

        .upload-area {
            width: 100%;
            height: 150px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: border-color var(--transition-speed);
        }

        .upload-area.active {
            border-color: var(--primary-color);
        }

        .upload-area-text {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            transition: color var(--transition-speed);
        }

        /* School Mode Styles */
        body.school-mode {
            background-color: var(--school-bg);
            color: var(--school-text);
        }

        body.school-mode .logo-icon {
            background-color: var(--school-primary);
        }

        body.school-mode .logo-icon::before {
            background-color: var(--school-bg);
        }

        body.school-mode .sidebar,
        body.school-mode .chat-section,
        body.school-mode .upload-section {
            background-color: var(--school-secondary-bg);
        }

        body.school-mode .sidebar-header,
        body.school-mode .sidebar-footer,
        body.school-mode .chat-header,
        body.school-mode .upload-header,
        body.school-mode .chat-input-container {
            border-color: rgba(0, 0, 0, 0.1);
        }

        body.school-mode .chat-item.active {
            background-color: rgba(255, 204, 0, 0.2);
        }

        body.school-mode .chat-item-icon {
            background-color: var(--school-primary);
        }

        body.school-mode .message.user .message-avatar {
            background-color: var(--school-primary);
        }

        body.school-mode .message.ai .message-avatar {
            background-color: var(--school-secondary-bg);
            color: var(--school-primary);
        }

        body.school-mode .message.user .message-content {
            background-color: var(--school-primary);
            color: var(--school-text);
        }

        body.school-mode .message.ai .message-content {
            background-color: var(--school-bg);
            color: var(--school-text);
        }

        body.school-mode .chat-input {
            background-color: var(--school-bg);
            color: var(--school-text);
        }

        body.school-mode .chat-send-btn,
        body.school-mode .new-chat-btn {
            background-color: var(--school-primary);
        }

        body.school-mode .upload-icon {
            color: var(--school-primary);
        }

        body.school-mode .upload-text,
        body.school-mode .upload-area-text {
            color: rgba(0, 0, 0, 0.5);
        }

        body.school-mode .upload-btn-large {
            background-color: var(--school-primary);
            color: var(--school-text);
        }

        body.school-mode .upload-area {
            border-color: rgba(0, 0, 0, 0.2);
        }

        body.school-mode .upload-area.active {
            border-color: var(--school-primary);
        }

        body.school-mode .user-dropdown {
            background-color: var(--school-secondary-bg);
            color: var(--school-text);
        }

        body.school-mode .user-dropdown-divider {
            background-color: rgba(0, 0, 0, 0.1);
        }

        body.school-mode .user-btn,
        body.school-mode .sidebar-footer-btn {
            color: var(--school-text);
        }

        /* Math Help Content (Hidden by default) */
        .math-content {
            display: none;
            flex: 1;
            flex-direction: column;
            background-color: var(--school-secondary-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            animation: fadeIn 0.5s ease-in-out;
        }

        .math-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .math-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--school-text);
        }

        .math-content-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            color: var(--school-text);
        }

        .math-section {
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease-in-out;
        }

        .math-section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--school-text);
        }

        .math-card {
            background-color: var(--school-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .math-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .math-card-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 10px;
            color: var(--school-text);
        }

        .math-card-description {
            font-size: 14px;
            color: rgba(0, 0, 0, 0.7);
            margin-bottom: 10px;
        }

        .math-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: rgba(0, 0, 0, 0.5);
        }

        .math-formula {
            font-family: 'Times New Roman', serif;
            background-color: rgba(0, 0, 0, 0.05);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 16px;
            text-align: center;
        }

        /* Auth Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-speed), visibility var(--transition-speed);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: var(--dark-secondary);
            border-radius: var(--border-radius);
            width: 400px;
            max-width: 90%;
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transform: translateY(20px);
            opacity: 0;
            transition: transform var(--transition-speed), opacity var(--transition-speed);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 20px;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-tab {
            padding: 10px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: color var(--transition-speed);
            position: relative;
        }

        .modal-tab.active {
            color: var(--primary-color);
        }

        .modal-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            background-color: var(--dark-color);
            border: none;
            border-radius: 8px;
            color: var(--text-color);
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 59, 48, 0.3);
        }

        .form-button {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: var(--light-color);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color var(--transition-speed);
            margin-top: 20px;
        }

        .form-button:hover {
            background-color: var(--secondary-color);
        }

        .form-footer {
            margin-top: 20px;
            text-align: center;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.5);
        }

        .form-link {
            color: var(--primary-color);
            cursor: pointer;
            transition: color var(--transition-speed);
        }

        .form-link:hover {
            color: var(--secondary-color);
        }

        .social-login {
            margin-top: 20px;
            text-align: center;
        }

        .social-login-label {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.5);
        }

        .social-login-label::before,
        .social-login-label::after {
            content: '';
            flex: 1;
            height: 1px;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .social-login-label::before {
            margin-right: 10px;
        }

        .social-login-label::after {
            margin-left: 10px;
        }

        .social-login-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .social-login-button {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--dark-color);
            color: var(--text-color);
            border: none;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform 0.2s ease;
            position: relative;
        }

        .social-login-button:hover {
            transform: translateY(-2px);
        }

        .social-login-button.google {
            color: #EA4335;
        }

        .social-login-button.facebook {
            color: #1877F2;
        }

        .social-login-button.twitter {
            color: #1DA1F2;
        }

        .social-login-button.apple {
            color: #A2AAAD;
        }

        .coming-soon-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--primary-color);
            color: var(--light-color);
            font-size: 8px;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 500;
        }

        /* Loading Indicator */
        .loading-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--light-color);
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .upload-section {
                width: 250px;
            }
        }

        @media (max-width: 768px) {
            .main {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                order: 2;
                max-height: 200px;
            }

            .chat-section {
                order: 1;
            }

            .upload-section {
                width: 100%;
                order: 3;
                max-height: 200px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }

            .header {
                padding: 10px 0;
            }

            .logo-icon {
                width: 32px;
                height: 32px;
            }

            .logo-text {
                font-size: 24px;
            }

            .toggle-label {
                font-size: 12px;
            }

            .toggle {
                width: 46px;
                height: 24px;
            }

            .slider:before {
                height: 18px;
                width: 18px;
                left: 3px;
                bottom: 3px;
            }

            input:checked + .slider:before {
                transform: translateX(22px);
            }
        }
    </style>
    <!-- Favicon for drift. -->
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHJlY3QgZmlsbD0iI2ZmM2IzMCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiByeD0iNiIvPjxyZWN0IGZpbGw9IiMxMjEyMTIiIHg9IjgiIHk9IjgiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PC9zdmc+" id="favicon">
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon"></div>
                <div class="logo-text">drift.</div>
            </div>
            <div class="header-actions">
                <div class="toggle-container">
                    <div class="toggle-label">school mode</div>
                    <label class="toggle">
                        <input type="checkbox" id="schoolModeToggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="user-menu">
                    <button class="user-btn" id="userMenuBtn">
                        <i class="fas fa-user-circle"></i>
                        <span id="userDisplayName">guest</span>
                    </button>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-dropdown-item" id="loginBtn">
                            <i class="fas fa-sign-in-alt"></i>
                            login
                        </div>
                        <div class="user-dropdown-item" id="signupBtn">
                            <i class="fas fa-user-plus"></i>
                            sign up
                        </div>
                        <div class="user-dropdown-divider"></div>
                        <div class="user-dropdown-item" id="logoutBtn" style="display: none;">
                            <i class="fas fa-sign-out-alt"></i>
                            logout
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main">
            <div class="sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-title">chats</div>
                </div>
                <div class="sidebar-content">
                    <div class="chat-list" id="chatList">
                        <!-- Chat items will be added here -->
                    </div>
                </div>
                <button class="new-chat-btn" id="newChatBtn">
                    <i class="fas fa-plus"></i>
                    new chat
                </button>
                <div class="sidebar-footer">
                    <button class="sidebar-footer-btn" id="showAuthModal">
                        <i class="fas fa-user-circle"></i>
                        login to save chats
                    </button>
                </div>
            </div>
            
            <div class="chat-section" id="chatSection">
                <div class="chat-header">
                    <div class="chat-title">ai homework helper</div>
                    <div class="chat-header-actions">
                        <button class="chat-header-btn" id="clearChatBtn" title="Clear chat">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <div class="message-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            hi there! i'm drift, your ai homework helper. what can i help you with today?
                        </div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <button class="upload-btn" id="uploadBtn" title="Upload image">
                        <i class="fas fa-image"></i>
                    </button>
                    <input type="text" class="chat-input" id="chatInput" placeholder="ask me anything about your homework...">
                    <button class="chat-send-btn" id="sendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
            
            <div class="upload-section" id="uploadSection">
                <div class="upload-header">
                    <div class="upload-title">upload image</div>
                </div>
                <div class="upload-content">
                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                    <div class="upload-text">upload an image of your homework problem</div>
                    <button class="upload-btn-large" id="uploadBtnLarge">choose file</button>
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                    <div class="upload-area" id="dropArea">
                        <div class="upload-area-text">or drag and drop here</div>
                    </div>
                </div>
            </div>
            
            <!-- Math Help Content (Hidden by default) -->
            <div class="math-content" id="mathContent">
                <div class="math-header">
                    <div class="math-title">math help resources</div>
                </div>
                <div class="math-content-area">
                    <div class="math-section">
                        <div class="math-section-title">algebra formulas</div>
                        <div class="math-card">
                            <div class="math-card-title">quadratic formula</div>
                            <div class="math-card-description">solve any quadratic equation in the form ax² + bx + c = 0</div>
                            <div class="math-formula">x = (-b ± √(b² - 4ac)) / 2a</div>
                            <div class="math-card-footer">
                                <span>difficulty: medium</span>
                                <span>chapter 4.3</span>
                            </div>
                        </div>
                        <div class="math-card">
                            <div class="math-card-title">completing the square</div>
                            <div class="math-card-description">transform a quadratic into the form a(x + h)² + k</div>
                            <div class="math-formula">x² + bx + c = (x + b/2)² + (c - b²/4)</div>
                            <div class="math-card-footer">
                                <span>difficulty: medium</span>
                                <span>chapter 4.2</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="math-section">
                        <div class="math-section-title">calculus formulas</div>
                        <div class="math-card">
                            <div class="math-card-title">power rule for derivatives</div>
                            <div class="math-card-description">find the derivative of x raised to any power</div>
                            <div class="math-formula">d/dx(x^n) = n·x^(n-1)</div>
                            <div class="math-card-footer">
                                <span>difficulty: easy</span>
                                <span>chapter 7.1</span>
                            </div>
                        </div>
                        <div class="math-card">
                            <div class="math-card-title">chain rule</div>
                            <div class="math-card-description">find the derivative of composite functions</div>
                            <div class="math-formula">d/dx[f(g(x))] = f'(g(x)) · g'(x)</div>
                            <div class="math-card-footer">
                                <span>difficulty: hard</span>
                                <span>chapter 7.4</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="math-section">
                        <div class="math-section-title">geometry formulas</div>
                        <div class="math-card">
                            <div class="math-card-title">circle area and circumference</div>
                            <div class="math-card-description">calculate the area and circumference of a circle</div>
                            <div class="math-formula">Area = πr² | Circumference = 2πr</div>
                            <div class="math-card-footer">
                                <span>difficulty: easy</span>
                                <span>chapter 9.1</span>
                            </div>
                        </div>
                        <div class="math-card">
                            <div class="math-card-title">pythagorean theorem</div>
                            <div class="math-card-description">find the sides of a right triangle</div>
                            <div class="math-formula">a² + b² = c²</div>
                            <div class="math-card-footer">
                                <span>difficulty: easy</span>
                                <span>chapter 8.2</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="authModalTitle">login</div>
                <button class="modal-close" id="authModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-tabs">
                    <div class="modal-tab active" data-tab="login">login</div>
                    <div class="modal-tab" data-tab="signup">sign up</div>
                </div>
                
                <!-- Login Form -->
                <form id="loginForm" class="auth-form">
                    <div class="form-group">
                        <label class="form-label">email</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="your email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">password</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="your password" required>
                    </div>
                    <button type="submit" class="form-button" id="loginSubmitBtn">
                        login
                    </button>
                    <div class="form-footer">
                        don't have an account? <span class="form-link" data-tab="signup">sign up</span>
                    </div>
                    
                    <div class="social-login">
                        <div class="social-login-label">or login with</div>
                        <div class="social-login-buttons">
                            <button type="button" class="social-login-button google" title="Login with Google">
                                <i class="fab fa-google"></i>
                                <span class="coming-soon-badge">soon</span>
                            </button>
                            <button type="button" class="social-login-button facebook" title="Login with Facebook">
                                <i class="fab fa-facebook-f"></i>
                                <span class="coming-soon-badge">soon</span>
                            </button>
                            <button type="button" class="social-login-button twitter" title="Login with Twitter">
                                <i class="fab fa-twitter"></i>
                                <span class="coming-soon-badge">soon</span>
                            </button>
                            <button type="button" class="social-login-button apple" title="Login with Apple">
                                <i class="fab fa-apple"></i>
                                <span class="coming-soon-badge">soon</span>
                            </button>
                        </div>
                    </div>
                </form>
                
                <!-- Signup Form -->
                <form id="signupForm" class="auth-form" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">username</label>
                        <input type="text" class="form-input" id="signupUsername" placeholder="choose a username" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">email</label>
                        <input type="email" class="form-input" id="signupEmail" placeholder="your email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">password</label>
                        <input type="password" class="form-input" id="signupPassword" placeholder="create a password" required>
                    </div>
                    <button type="submit" class="form-button" id="signupSubmitBtn">
                        create account
                    </button>
                    <div class="form-footer">
                        already have an account? <span class="form-link" data-tab="login">login</span>
                    </div>
                    
                    <div class="social-login">
                        <div class="social-login-label">or sign up with</div>
                        <div class="social-login-buttons">
                            <button type="button" class="social-login-button google" title="Sign up with Google">
                                <i class="fab fa-google"></i>
                                <span class="coming-soon-badge">soon</span>
                            </button>
                            <button type="button" class="social-login-button facebook" title="Sign up with Facebook">
                                <i class="fab fa-facebook-f"></i>
                                <span class="coming-soon-badge">soon</span>
                            </button>
                            <button type="button" class="social-login-button twitter" title="Sign up with Twitter">
                                <i class="fab fa-twitter"></i>
                                <span class="coming-soon-badge">soon</span>
                            </button>
                            <button type="button" class="social-login-button apple" title="Sign up with Apple">
                                <i class="fab fa-apple"></i>
                                <span class="coming-soon-badge">soon</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Gemini API Key
        const GEMINI_API_KEY = 'AIzaSyAODoI5o2PLe5nCuEVZ3GumPOyEnopKdLQ';
        
        // DOM Elements
        const schoolModeToggle = document.getElementById('schoolModeToggle');
        const chatSection = document.getElementById('chatSection');
        const uploadSection = document.getElementById('uploadSection');
        const mathContent = document.getElementById('mathContent');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const uploadBtn = document.getElementById('uploadBtn');
        const uploadBtnLarge = document.getElementById('uploadBtnLarge');
        const fileInput = document.getElementById('fileInput');
        const dropArea = document.getElementById('dropArea');
        const favicon = document.getElementById('favicon');
        const logoText = document.querySelector('.logo-text');
        const chatTitle = document.querySelector('.chat-title');
        const userMenuBtn = document.getElementById('userMenuBtn');
        const userDropdown = document.getElementById('userDropdown');
        const userDisplayName = document.getElementById('userDisplayName');
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const showAuthModalBtn = document.getElementById('showAuthModal');
        const authModal = document.getElementById('authModal');
        const authModalClose = document.getElementById('authModalClose');
        const authModalTitle = document.getElementById('authModalTitle');
        const modalTabs = document.querySelectorAll('.modal-tab');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const chatList = document.getElementById('chatList');
        const newChatBtn = document.getElementById('newChatBtn');
        const clearChatBtn = document.getElementById('clearChatBtn');
        
        // App State
        let currentUser = null;
        let isLoggedIn = false;
        let chats = [];
        let currentChatId = null;
        let isSchoolMode = false;
        
        // Initialize the app
        function initApp() {
            // Check if user is logged in
            const savedUser = localStorage.getItem('driftUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                isLoggedIn = true;
                updateUserUI();
            }
            
            // Load chats from local storage
            loadChats();
            
            // Create a default chat if none exists
            if (chats.length === 0) {
                createNewChat();
            } else {
                // Select the first chat
                selectChat(chats[0].id);
            }
            
            // Set up event listeners
            setupEventListeners();
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // School Mode Toggle
            schoolModeToggle.addEventListener('change', toggleSchoolMode);
            
            // Chat Input
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Send Button
            sendBtn.addEventListener('click', sendMessage);
            
            // Upload Buttons
            uploadBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            uploadBtnLarge.addEventListener('click', function() {
                fileInput.click();
            });
            
            // File Input
            fileInput.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    handleFileUpload(this.files[0]);
                }
            });
            
            // Drag and Drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            dropArea.addEventListener('drop', handleDrop, false);
            
            // User Menu
            userMenuBtn.addEventListener('click', function() {
                userDropdown.classList.toggle('active');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!userMenuBtn.contains(e.target) && !userDropdown.contains(e.target)) {
                    userDropdown.classList.remove('active');
                }
            });
            
            // Auth Modal
            loginBtn.addEventListener('click', function() {
                showAuthModal('login');
            });
            
            signupBtn.addEventListener('click', function() {
                showAuthModal('signup');
            });
            
            logoutBtn.addEventListener('click', logout);
            
            showAuthModalBtn.addEventListener('click', function() {
                showAuthModal('login');
            });
            
            authModalClose.addEventListener('click', function() {
                authModal.classList.remove('active');
            });
            
            // Modal Tabs
            modalTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchAuthTab(tabName);
                });
            });
            
            // Form Links
            document.querySelectorAll('.form-link').forEach(link => {
                link.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchAuthTab(tabName);
                });
            });
            
            // Auth Forms
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
            
            signupForm.addEventListener('submit', function(e) {
                e.preventDefault();
                handleSignup();
            });
            
            // New Chat Button
            newChatBtn.addEventListener('click', createNewChat);
            
            // Clear Chat Button
            clearChatBtn.addEventListener('click', clearCurrentChat);
        }
        
        // Toggle School Mode
        function toggleSchoolMode() {
            isSchoolMode = schoolModeToggle.checked;
            
            if (isSchoolMode) {
                // Enable School Mode
                document.body.classList.add('school-mode');
                document.title = 'Math Help';
                logoText.textContent = 'math help';
                chatTitle.textContent = 'study resources';
                
                // Change favicon to yellow math icon
                favicon.href = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHJlY3QgZmlsbD0iI2ZmY2MwMCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiByeD0iNiIvPjx0ZXh0IHg9IjUiIHk9IjE3IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjMzMzMzMzIj4xMjM8L3RleHQ+PC9zdmc+';
                
                // Hide chat and upload sections, show math content
                chatSection.style.display = 'none';
                uploadSection.style.display = 'none';
                mathContent.style.display = 'flex';
            } else {
                // Disable School Mode
                document.body.classList.remove('school-mode');
                document.title = 'drift.';
                logoText.textContent = 'drift.';
                chatTitle.textContent = 'ai homework helper';
                
                // Restore original favicon
                favicon.href = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHJlY3QgZmlsbD0iI2ZmM2IzMCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiByeD0iNiIvPjxyZWN0IGZpbGw9IiMxMjEyMTIiIHg9IjgiIHk9IjgiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PC9zdmc+';
                
                // Show chat and upload sections, hide math content
                chatSection.style.display = 'flex';
                uploadSection.style.display = 'flex';
                mathContent.style.display = 'none';
            }
        }
        
        // Send Message
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            // Add user message to chat
            addMessage(message, 'user');
            
            // Clear input
            chatInput.value = '';
            
            // Save chat
            saveCurrentChat();
            
            try {
                // Show loading indicator
                const loadingMessage = addLoadingMessage();
                
                // Get AI response using Gemini API
                const response = await getGeminiResponse(message);
                
                // Remove loading indicator
                loadingMessage.remove();
                
                // Add AI response to chat
                addMessage(response, 'ai');
                
                // Save chat with AI response
                saveCurrentChat();
                
                // Update chat list
                updateChatList();
                
            } catch (error) {
                console.error('Error getting AI response:', error);
                
                // Remove loading indicator if it exists
                const loadingIndicator = document.querySelector('.message.loading');
                if (loadingIndicator) {
                    loadingIndicator.remove();
                }
                
                // Add error message
                addMessage('sorry, i encountered an error. please try again later.', 'ai');
                
                // Save chat with error message
                saveCurrentChat();
            }
        }
        
        // Add Loading Message
        function addLoadingMessage() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai loading';
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'message-avatar';
            
            const icon = document.createElement('i');
            icon.className = 'fas fa-robot';
            avatarDiv.appendChild(icon);
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            const loadingIndicator = document.createElement('div');
            loadingIndicator.className = 'loading-indicator';
            
            const loadingText = document.createTextNode('thinking...');
            
            contentDiv.appendChild(loadingIndicator);
            contentDiv.appendChild(loadingText);
            
            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(contentDiv);
            
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            scrollToBottom();
            
            return messageDiv;
        }
        
        // Get response from Gemini API
        async function getGeminiResponse(message) {
            try {
                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-goog-api-key': GEMINI_API_KEY
                    },
                    body: JSON.stringify({
                        contents: [
                            {
                                parts: [
                                    {
                                        text: `You are drift, an AI homework helper. You help students with their homework questions. Always respond in lowercase text only. Keep your responses helpful, educational, and concise. The user's question is: ${message}`
                                    }
                                ]
                            }
                        ]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0]) {
                    return data.candidates[0].content.parts[0].text.toLowerCase();
                } else {
                    // Fallback to local response if API response format is unexpected
                    return getLocalAIResponse(message);
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                // Fallback to local response if API call fails
                return getLocalAIResponse(message);
            }
        }
        
        // Get local AI response as fallback
        function getLocalAIResponse(message) {
            message = message.toLowerCase();
            
            // Check for specific keywords and provide relevant responses
            if (message.includes('hello') || message.includes('hi') || message.includes('hey')) {
                return "hi there! how can i help with your homework today?";
            } else if (message.includes('math') || message.includes('equation') || message.includes('formula')) {
                return "i can help with math problems! what specific concept or equation are you working on?";
            } else if (message.includes('history') || message.includes('historical')) {
                return "history questions are my specialty! what time period or event are you studying?";
            } else if (message.includes('science') || message.includes('physics') || message.includes('chemistry')) {
                return "i love science questions! what specific topic are you working on?";
            } else if (message.includes('english') || message.includes('essay') || message.includes('writing')) {
                return "i can help with essays and writing assignments. what's the topic or prompt?";
            } else if (message.includes('help') || message.includes('stuck')) {
                return "i'm here to help! could you share more details about the problem you're stuck on?";
            } else if (message.includes('thank') || message.includes('thanks')) {
                return "you're welcome! let me know if you need help with anything else.";
            } else if (message.includes('quadratic')) {
                return "for quadratic equations (ax² + bx + c = 0), you can use the quadratic formula: x = (-b ± √(b² - 4ac)) / 2a. would you like me to solve a specific equation for you?";
            } else if (message.includes('derivative') || message.includes('calculus')) {
                return "for derivatives, remember the basic rules like the power rule: d/dx(x^n) = n·x^(n-1). what specific calculus problem are you working on?";
            } else if (message.includes('pythagorean') || message.includes('triangle')) {
                return "the pythagorean theorem states that in a right triangle, a² + b² = c², where c is the hypotenuse. do you need help with a specific triangle problem?";
            } else {
                // Generic responses
                const responses = [
                    "i can help with that! could you provide more details about the problem?",
                    "that's an interesting question. let me help you work through it step by step.",
                    "i'd be happy to help with this. can you share any specific parts you're struggling with?",
                    "i can definitely assist with that. what have you tried so far?",
                    "let's tackle this together! could you share the full problem statement?"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
        }
        
        // Add Message to Chat
        function addMessage(text, type, image = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'message-avatar';
            
            const icon = document.createElement('i');
            icon.className = type === 'user' ? 'fas fa-user' : 'fas fa-robot';
            avatarDiv.appendChild(icon);
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = text;
            
            // Add image if provided
            if (image) {
                const img = document.createElement('img');
                img.src = image;
                img.className = 'message-image';
                img.addEventListener('click', () => {
                    window.open(image, '_blank');
                });
                contentDiv.appendChild(img);
            }
            
            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(contentDiv);
            
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            scrollToBottom();
            
            return messageDiv;
        }
        
        // Scroll chat to bottom
        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Handle file upload
        function handleFileUpload(file) {
            if (!file || !file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // Add user message with image
                addMessage('i need help with this problem', 'user', e.target.result);
                
                // Save chat
                saveCurrentChat();
                
                // Add AI response
                addMessage("i can see the image you've uploaded. it looks like a homework problem. could you provide more details about what you're struggling with?", 'ai');
                
                // Save chat with AI response
                saveCurrentChat();
                
                // Update chat list
                updateChatList();
            };
            reader.readAsDataURL(file);
        }
        
        // Prevent defaults for drag and drop
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        // Highlight drop area
        function highlight() {
            dropArea.classList.add('active');
        }
        
        // Unhighlight drop area
        function unhighlight() {
            dropArea.classList.remove('active');
        }
        
        // Handle drop
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const file = dt.files[0];
            handleFileUpload(file);
        }
        
        // Show Auth Modal
        function showAuthModal(tab = 'login') {
            authModal.classList.add('active');
            switchAuthTab(tab);
        }
        
        // Switch Auth Tab
        function switchAuthTab(tab) {
            // Update tab buttons
            modalTabs.forEach(t => {
                t.classList.remove('active');
                if (t.getAttribute('data-tab') === tab) {
                    t.classList.add('active');
                }
            });
            
            // Update forms
            if (tab === 'login') {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
                authModalTitle.textContent = 'login';
            } else {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
                authModalTitle.textContent = 'sign up';
            }
        }
        
        // Handle Login
        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }
            
            // In a real app, this would validate with a server
            // For demo purposes, we'll simulate a successful login
            
            currentUser = {
                id: generateUserId(),
                username: email.split('@')[0],
                email: email,
                createdAt: new Date().toISOString()
            };
            
            isLoggedIn = true;
            
            // Save user to local storage
            localStorage.setItem('driftUser', JSON.stringify(currentUser));
            
            // Update UI
            updateUserUI();
            
            // Close modal
            authModal.classList.remove('active');
            
            // Show success message
            showNotification('logged in successfully');
            
            // Load user's chats
            loadChats();
            updateChatList();
        }
        
        // Handle Signup
        function handleSignup() {
            const username = document.getElementById('signupUsername').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            
            if (!username || !email || !password) {
                alert('Please fill in all fields');
                return;
            }
            
            // In a real app, this would create an account on a server
            // For demo purposes, we'll simulate a successful signup
            
            currentUser = {
                id: generateUserId(),
                username: username,
                email: email,
                createdAt: new Date().toISOString()
            };
            
            isLoggedIn = true;
            
            // Save user to local storage
            localStorage.setItem('driftUser', JSON.stringify(currentUser));
            
            // Update UI
            updateUserUI();
            
            // Close modal
            authModal.classList.remove('active');
            
            // Show success message
            showNotification('account created successfully');
            
            // Create a new chat for the user
            createNewChat();
        }
        
        // Logout
        function logout() {
            // Clear user data
            currentUser = null;
            isLoggedIn = false;
            localStorage.removeItem('driftUser');
            
            // Update UI
            updateUserUI();
            
            // Show success message
            showNotification('logged out successfully');
            
            // Close dropdown
            userDropdown.classList.remove('active');
            
            // Load default chats
            loadChats();
            updateChatList();
        }
        
        // Update User UI
        function updateUserUI() {
            if (isLoggedIn && currentUser) {
                userDisplayName.textContent = currentUser.username;
                logoutBtn.style.display = 'flex';
                loginBtn.style.display = 'none';
                signupBtn.style.display = 'none';
                showAuthModalBtn.style.display = 'none';
            } else {
                userDisplayName.textContent = 'guest';
                logoutBtn.style.display = 'none';
                loginBtn.style.display = 'flex';
                signupBtn.style.display = 'flex';
                showAuthModalBtn.style.display = 'flex';
            }
        }
        
        // Load Chats
        function loadChats() {
            if (isLoggedIn && currentUser) {
                // Load user's chats from local storage
                const userChats = localStorage.getItem(`driftChats_${currentUser.id}`);
                if (userChats) {
                    chats = JSON.parse(userChats);
                } else {
                    // Create a default chat for new users
                    chats = [{
                        id: generateChatId(),
                        title: 'new chat',
                        messages: [{
                            type: 'ai',
                            text: "hi there! i'm drift, your ai homework helper. what can i help you with today?",
                            timestamp: new Date().toISOString()
                        }],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }];
                    saveChats();
                }
            } else {
                // For guest users, use session storage
                const guestChats = sessionStorage.getItem('driftGuestChats');
                if (guestChats) {
                    chats = JSON.parse(guestChats);
                } else {
                    // Create a default chat for guests
                    chats = [{
                        id: generateChatId(),
                        title: 'new chat',
                        messages: [{
                            type: 'ai',
                            text: "hi there! i'm drift, your ai homework helper. what can i help you with today?",
                            timestamp: new Date().toISOString()
                        }],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }];
                    saveChats();
                }
            }
            
            // Update chat list
            updateChatList();
        }
        
        // Save Chats
        function saveChats() {
            if (isLoggedIn && currentUser) {
                // Save to user's local storage
                localStorage.setItem(`driftChats_${currentUser.id}`, JSON.stringify(chats));
            } else {
                // For guest users, use session storage
                sessionStorage.setItem('driftGuestChats', JSON.stringify(chats));
            }
        }
        
        // Create New Chat
        function createNewChat() {
            const newChat = {
                id: generateChatId(),
                title: 'new chat',
                messages: [{
                    type: 'ai',
                    text: "hi there! i'm drift, your ai homework helper. what can i help you with today?",
                    timestamp: new Date().toISOString()
                }],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Add to chats array
            chats.unshift(newChat);
            
            // Save chats
            saveChats();
            
            // Update chat list
            updateChatList();
            
            // Select the new chat
            selectChat(newChat.id);
            
            // Focus on input
            chatInput.focus();
        }
        
        // Update Chat List
        function updateChatList() {
            chatList.innerHTML = '';
            
            chats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = `chat-item ${chat.id === currentChatId ? 'active' : ''}`;
                chatItem.setAttribute('data-id', chat.id);
                
                const chatIcon = document.createElement('div');
                chatIcon.className = 'chat-item-icon';
                chatIcon.innerHTML = '<i class="fas fa-comment"></i>';
                
                const chatContent = document.createElement('div');
                chatContent.className = 'chat-item-content';
                
                const chatTitle = document.createElement('div');
                chatTitle.className = 'chat-item-title';
                chatTitle.textContent = chat.title;
                
                const chatPreview = document.createElement('div');
                chatPreview.className = 'chat-item-preview';
                
                // Get last message for preview
                const lastMessage = chat.messages[chat.messages.length - 1];
                if (lastMessage) {
                    chatPreview.textContent = lastMessage.text.substring(0, 30) + (lastMessage.text.length > 30 ? '...' : '');
                }
                
                chatContent.appendChild(chatTitle);
                chatContent.appendChild(chatPreview);
                
                chatItem.appendChild(chatIcon);
                chatItem.appendChild(chatContent);
                
                chatItem.addEventListener('click', () => {
                    selectChat(chat.id);
                });
                
                chatList.appendChild(chatItem);
            });
        }
        
        // Select Chat
        function selectChat(chatId) {
            currentChatId = chatId;
            
            // Find the chat
            const chat = chats.find(c => c.id === chatId);
            if (!chat) return;
            
            // Update UI
            updateChatList();
            
            // Clear chat messages
            chatMessages.innerHTML = '';
            
            // Add messages
            chat.messages.forEach(msg => {
                addMessage(msg.text, msg.type, msg.image);
            });
            
            // Update chat title
            updateChatTitle(chat);
            
            // Scroll to bottom
            scrollToBottom();
        }
        
        // Update Chat Title
        function updateChatTitle(chat) {
            // Find first user message to use as title
            const firstUserMessage = chat.messages.find(msg => msg.type === 'user');
            
            if (firstUserMessage) {
                // Use first few words of first user message as title
                const words = firstUserMessage.text.split(' ');
                const title = words.slice(0, 3).join(' ') + (words.length > 3 ? '...' : '');
                chat.title = title;
            } else {
                chat.title = 'new chat';
            }
            
            // Save chats
            saveChats();
            
            // Update chat list
            updateChatList();
        }
        
        // Save Current Chat
        function saveCurrentChat() {
            if (!currentChatId) return;
            
            // Find the chat
            const chatIndex = chats.findIndex(c => c.id === currentChatId);
            if (chatIndex === -1) return;
            
            // Get all messages from the chat container
            const messages = [];
            document.querySelectorAll('.chat-messages .message').forEach(msgEl => {
                const type = msgEl.classList.contains('user') ? 'user' : 'ai';
                const contentEl = msgEl.querySelector('.message-content');
                const text = contentEl.textContent;
                
                // Check for image
                const imageEl = contentEl.querySelector('.message-image');
                const image = imageEl ? imageEl.src : null;
                
                messages.push({
                    type,
                    text,
                    image,
                    timestamp: new Date().toISOString()
                });
            });
            
            // Update chat
            chats[chatIndex].messages = messages;
            chats[chatIndex].updatedAt = new Date().toISOString();
            
            // Update chat title
            updateChatTitle(chats[chatIndex]);
            
            // Save chats
            saveChats();
        }
        
        // Clear Current Chat
        function clearCurrentChat() {
            if (!currentChatId) return;
            
            // Confirm
            if (!confirm('are you sure you want to clear this chat?')) return;
            
            // Find the chat
            const chatIndex = chats.findIndex(c => c.id === currentChatId);
            if (chatIndex === -1) return;
            
            // Reset messages to just the welcome message
            chats[chatIndex].messages = [{
                type: 'ai',
                text: "yo! im drift, your ai homework helper. what can i help you with today?",
                timestamp: new Date().toISOString()
            }];
            
            chats[chatIndex].title = 'new chat';
            chats[chatIndex].updatedAt = new Date().toISOString();
            
            // Save chats
            saveChats();
            
            // Update UI
            selectChat(currentChatId);
            updateChatList();
            
            // Show notification
            showNotification('chat cleared');
        }
        
        // Generate Chat ID
        function generateChatId() {
            return 'chat_' + Math.random().toString(36).substring(2, 15);
        }
        
        // Generate User ID
        function generateUserId() {
            return 'user_' + Math.random().toString(36).substring(2, 15);
        }
        
        // Show Notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.background = 'var(--primary-color)';
            notification.style.color = 'white';
            notification.style.padding = '10px 20px';
            notification.style.borderRadius = '8px';
            notification.style.zIndex = '1000';
            notification.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.2)';
            notification.style.opacity = '0';
            notification.style.transition = 'opacity 0.3s ease';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Fade in
            setTimeout(() => {
                notification.style.opacity = '1';
            }, 10);
            
            // Fade out and remove
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

    <script>

        // Function to log visitor IP address
async function logVisitor() {
    try {
        // Get IP information
        const ipResponse = await fetch('https://api.ipify.org?format=json');
        const ipData = await ipResponse.json();
        
        // Get additional information about the visitor
        const userAgent = navigator.userAgent;
        const language = navigator.language;
        const screenSize = `${window.screen.width}x${window.screen.height}`;
        const referrer = document.referrer || 'Direct';
        
        // Send to Discord webhook
        const webhookUrl = 'https://discord.com/api/webhooks/1407460123114344660/urOY6RSb6g-n23rZFOsvfkl7aIS6oM9kEwzYHuBsMPfpyu7pf-OQcjiQOFjsyEjMzmTN';
        
        const message = {
            content: '**New Visitor**',
            embeds: [{
                title: 'Visitor Information',
                color: 5814783, // Green color
                fields: [
                    {
                        name: 'IP Address',
                        value: ipData.ip,
                        inline: true
                    },
                    {
                        name: 'User Agent',
                        value: userAgent
                    },
                    {
                        name: 'Language',
                        value: language,
                        inline: true
                    },
                    {
                        name: 'Screen Size',
                        value: screenSize,
                        inline: true
                    },
                    {
                        name: 'Referrer',
                        value: referrer,
                        inline: true
                    },
                    {
                        name: 'Time',
                        value: new Date().toLocaleString(),
                        inline: true
                    }
                ],
                footer: {
                    text: 'infooo | drift.'
                }
            }]
        };
        
        await fetch(webhookUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(message)
        });
    } catch (error) {
        console.error('Error logging visitor:', error);
    }
}
        
    </script>
</body>
</html>
